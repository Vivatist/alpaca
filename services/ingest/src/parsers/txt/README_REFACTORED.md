# TXT Parser Module

–ú–æ–¥—É–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø–∞—Ä—Å–µ—Ä–∞ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Ñ–∞–π–ª–æ–≤ –¥–ª—è ALPACA RAG —Å–∏—Å—Ç–µ–º—ã.

## üìä –ú–µ—Ç—Ä–∏–∫–∏ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞

**–î–æ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞:**
- `txt_parser.py`: **245 —Å—Ç—Ä–æ–∫** (–º–æ–Ω–æ–ª–∏—Ç–Ω—ã–π —Ñ–∞–π–ª, –≤–æ–∑–≤—Ä–∞—â–∞–ª Dict)

**–ü–æ—Å–ª–µ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞:**
- `txt_parser.py`: **103 —Å—Ç—Ä–æ–∫–∏** (-58%)
- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–æ–¥—É–ª–∏: **161 —Å—Ç—Ä–æ–∫–∞** (—Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–æ –ø–æ 3 –º–æ–¥—É–ª—è–º)
- **–ò—Ç–æ–≥–æ**: 264 —Å—Ç—Ä–æ–∫–∏ (+8% –∑–∞ —Å—á—ë—Ç —É–ª—É—á—à–µ–Ω–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã)

**–†–µ–∑—É–ª—å—Ç–∞—Ç**: –ì–ª–∞–≤–Ω—ã–π —Ñ–∞–π–ª —É–º–µ–Ω—å—à–∏–ª—Å—è –≤ **2.4 —Ä–∞–∑–∞**, –ª–æ–≥–∏–∫–∞ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∞ –ø–æ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –º–æ–¥—É–ª—è–º, –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —É–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω —Å BaseParser.

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
txt_parser_module/
‚îú‚îÄ‚îÄ __init__.py                  # –ü—É–±–ª–∏—á–Ω—ã–π API –º–æ–¥—É–ª—è (14 —Å—Ç—Ä–æ–∫)
‚îú‚îÄ‚îÄ txt_parser.py                # –ì–ª–∞–≤–Ω—ã–π –∫–ª–∞—Å—Å TXTParser (103 —Å—Ç—Ä–æ–∫–∏) ‚≠ê
‚îú‚îÄ‚îÄ encoding_detector.py         # –ê–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∫–æ–¥–∏—Ä–æ–≤–∫–∏ (75 —Å—Ç—Ä–æ–∫)
‚îú‚îÄ‚îÄ text_formatter.py            # –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ Markdown (43 —Å—Ç—Ä–æ–∫–∏)
‚îî‚îÄ‚îÄ metadata_extractor.py        # –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö (48 —Å—Ç—Ä–æ–∫)
```

## üì¶ –ú–æ–¥—É–ª–∏

### `txt_parser.py` - –ì–ª–∞–≤–Ω—ã–π –∫–ª–∞—Å—Å

**103 —Å—Ç—Ä–æ–∫–∏** (–±—ã–ª–æ 245)

–ö–æ–æ—Ä–¥–∏–Ω–∏—Ä—É–µ—Ç —Ä–∞–±–æ—Ç—É –≤—Å–µ—Ö –º–æ–¥—É–ª–µ–π, —Ä–µ–∞–ª–∏–∑—É–µ—Ç –æ—Å–Ω–æ–≤–Ω–æ–π pipeline:

```python
from alpaca.application.document_processing.parsers.txt_parser_module.txt_parser import TXTParser

parser = TXTParser()
result = parser.parse(file_object)  # –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç str (–±—ã–ª–æ Dict)
```

**–ò–∑–º–µ–Ω–µ–Ω–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞:**
- ‚úÖ –ê–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–Ω –∫ `BaseParser` - —Ç–µ–ø–µ—Ä—å –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `str` –≤–º–µ—Å—Ç–æ `Dict`
- ‚úÖ –ü—Ä–∏–Ω–∏–º–∞–µ—Ç –æ–±—ä–µ–∫—Ç `File` –≤–º–µ—Å—Ç–æ `file_path` –∏ `file_hash`
- ‚úÖ –£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω —Å –¥—Ä—É–≥–∏–º–∏ –ø–∞—Ä—Å–µ—Ä–∞–º–∏ (word_parser, pdf_parser –∏ —Ç.–¥.)

**–ú–µ—Ç–æ–¥—ã:**
- `parse(file)` - –æ—Å–Ω–æ–≤–Ω–æ–π –º–µ—Ç–æ–¥ –ø–∞—Ä—Å–∏–Ω–≥–∞

### `encoding_detector.py` - –ê–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∫–æ–¥–∏—Ä–æ–≤–∫–∏

**75 —Å—Ç—Ä–æ–∫**

–û–ø—Ä–µ–¥–µ–ª—è–µ—Ç –∫–æ–¥–∏—Ä–æ–≤–∫—É —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ —Ñ–∞–π–ª–∞ —á–µ—Ä–µ–∑ chardet.

```python
from alpaca.application.document_processing.parsers.txt_parser_module.encoding_detector import detect_encoding

encoding = detect_encoding("/path/to/file.txt")
# 'utf-8', 'windows-1251', 'ascii', etc.
```

**–§—É–Ω–∫—Ü–∏–∏:**
- `detect_encoding(file_path)` ‚Üí `str`

**–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –∫–æ–¥–∏—Ä–æ–≤–∫–∏:**
- UTF-8
- Windows-1251 (CP1251)
- ASCII
- Latin-1 (ISO-8859-1)
- –ò –¥—Ä—É–≥–∏–µ —á–µ—Ä–µ–∑ chardet

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –ß–∏—Ç–∞–µ—Ç –ø–µ—Ä–≤—ã–µ 10KB –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è
- Fallback –Ω–∞ UTF-8 –ø—Ä–∏ –Ω–∏–∑–∫–æ–π —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏ (< 70%)
- –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –Ω–∞–∑–≤–∞–Ω–∏–π –∫–æ–¥–∏—Ä–æ–≤–æ–∫
- Graceful degradation –µ—Å–ª–∏ chardet –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω

### `text_formatter.py` - –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞

**43 —Å—Ç—Ä–æ–∫–∏**

–ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç –æ–±—ã—á–Ω—ã–π —Ç–µ–∫—Å—Ç –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π Markdown.

```python
from alpaca.application.document_processing.parsers.txt_parser_module.text_formatter import format_as_markdown

markdown = format_as_markdown(content, "document.txt")
```

**–§—É–Ω–∫—Ü–∏–∏:**
- `format_as_markdown(content, filename)` ‚Üí `str`

**–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:**
- –î–æ–±–∞–≤–ª—è–µ—Ç H1 –∑–∞–≥–æ–ª–æ–≤–æ–∫ –∏–∑ –∏–º–µ–Ω–∏ —Ñ–∞–π–ª–∞
- –†–∞–∑–±–∏–≤–∞–µ—Ç –Ω–∞ –∞–±–∑–∞—Ü—ã (–ø–æ –¥–≤–æ–π–Ω—ã–º –ø–µ—Ä–µ–≤–æ–¥–∞–º —Å—Ç—Ä–æ–∫)
- –°–æ—Ö—Ä–∞–Ω—è–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–æ–∫—É–º–µ–Ω—Ç–∞
- –£–¥–∞–ª—è–µ—Ç –ª–∏—à–Ω–∏–µ –ø—Ä–æ–±–µ–ª—ã

### `metadata_extractor.py` - –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö

**48 —Å—Ç—Ä–æ–∫**

–ò–∑–≤–ª–µ–∫–∞–µ—Ç —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –¥–ª—è TXT –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ.

```python
from alpaca.application.document_processing.parsers.txt_parser_module.metadata_extractor import extract_txt_metadata

metadata = extract_txt_metadata("utf-8", content)
# {'encoding': 'utf-8', 'lines': 42, 'characters': 1234, 'words': 234}
```

**–§—É–Ω–∫—Ü–∏–∏:**
- `extract_txt_metadata(encoding, content)` ‚Üí `Dict`
  - `encoding` - –∫–æ–¥–∏—Ä–æ–≤–∫–∞ —Ñ–∞–π–ª–∞
  - `lines` - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–æ–∫
  - `characters` - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–∏–º–≤–æ–ª–æ–≤
  - `words` - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–ª–æ–≤

## üîÑ Pipeline –æ–±—Ä–∞–±–æ—Ç–∫–∏

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   .txt —Ñ–∞–π–ª     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ 1. encoding_detector.detect_encoding()
         ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  –ß—Ç–µ–Ω–∏–µ —Ñ–∞–π–ª–∞   ‚îÇ
‚îÇ  —Å –∫–æ–¥–∏—Ä–æ–≤–∫–æ–π   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ 2. metadata_extractor.extract_txt_metadata()
         ‚îÇ 3. text_formatter.format_as_markdown()
         ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Markdown —Ç–µ–∫—Å—Ç ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–ü–∞—Ä—Å–µ—Ä —É—Å–ø–µ—à–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Ç–µ–∫—Å—Ç–æ–≤—ã–µ —Ñ–∞–π–ª—ã:

```bash
python test_refactored_txt_parser.py
# ‚úÖ –ü–∞—Ä—Å–∏–Ω–≥ –∑–∞–≤–µ—Ä—à—ë–Ω
# üìä –î–ª–∏–Ω–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞: 184 —Å–∏–º–≤–æ–ª–∞
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
- ‚úÖ –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∫–æ–¥–∏—Ä–æ–≤–∫–∏ (UTF-8)
- ‚úÖ –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ Markdown
- ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–æ–∫—É–º–µ–Ω—Ç–∞
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ä—É—Å—Å–∫–æ–≥–æ —Ç–µ–∫—Å—Ç–∞

## üìù –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ë–∞–∑–æ–≤–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

```python
from alpaca.application.document_processing.parsers.txt_parser_module.txt_parser import TXTParser

# –°–æ–∑–¥–∞–µ–º –ø–∞—Ä—Å–µ—Ä
parser = TXTParser()

# –ü–∞—Ä—Å–∏–º —Ñ–∞–π–ª (–Ω–æ–≤—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å)
result = parser.parse(file_object)  # str
```

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –º–æ–¥—É–ª–µ–π

```python
# –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∫–æ–¥–∏—Ä–æ–≤–∫–∏
from alpaca.application.document_processing.parsers.txt_parser_module.encoding_detector import detect_encoding
encoding = detect_encoding("/path/to/file.txt")

# –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö
from alpaca.application.document_processing.parsers.txt_parser_module.metadata_extractor import extract_txt_metadata
metadata = extract_txt_metadata(encoding, content)

# –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
from alpaca.application.document_processing.parsers.txt_parser_module.text_formatter import format_as_markdown
markdown = format_as_markdown(content, "file.txt")
```

## üéØ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –¥–µ–∫–æ–º–ø–æ–∑–∏—Ü–∏–∏

1. **–ß–∏—Ç–∞–µ–º–æ—Å—Ç—å** - –≥–ª–∞–≤–Ω—ã–π —Ñ–∞–π–ª —É–º–µ–Ω—å—à–∏–ª—Å—è –≤ 2.4 —Ä–∞–∑–∞
2. **–ü–æ–≤—Ç–æ—Ä–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ** - –º–æ–¥—É–ª–∏ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ
3. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** - –ª–µ–≥—á–µ –ø–∏—Å–∞—Ç—å unit-—Ç–µ—Å—Ç—ã –¥–ª—è –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π
4. **–ü–æ–¥–¥–µ—Ä–∂–∫–∞** - –∏–∑–º–µ–Ω–µ–Ω–∏—è –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω—ã –≤ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –º–æ–¥—É–ª—è—Ö
5. **–£–Ω–∏—Ñ–∏–∫–∞—Ü–∏—è** - –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç BaseParser (–≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç str)

## üîÑ –ò–∑–º–µ–Ω–µ–Ω–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞

### –ë—ã–ª–æ (v1.0)

```python
result = parser.parse(file_path, file_hash)  # Dict
# {
#   'markdown': str,
#   'metadata': Dict,
#   'yaml_header': str,
#   'success': bool,
#   'error': Optional[str]
# }
```

### –°—Ç–∞–ª–æ (v2.0)

```python
result = parser.parse(file_object)  # str
# –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –Ω–∞–ø—Ä—è–º—É—é —Ç–µ–∫—Å—Ç –¥–æ–∫—É–º–µ–Ω—Ç–∞
# –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É BaseParser
```

**–ü–æ—á–µ–º—É –∏–∑–º–µ–Ω–∏–ª–∏:**
- –£–Ω–∏—Ñ–∏–∫–∞—Ü–∏—è —Å –¥—Ä—É–≥–∏–º–∏ –ø–∞—Ä—Å–µ—Ä–∞–º–∏ (word_parser, pdf_parser)
- –£–ø—Ä–æ—â–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ - –æ–¥–∏–Ω —Ç–∏–ø –≤–æ–∑–≤—Ä–∞—â–∞–µ–º–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è
- –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –∫–æ–Ω—Ç—Ä–∞–∫—Ç—É BaseParser

## üìã –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

- **chardet** - –∞–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∫–æ–¥–∏—Ä–æ–≤–∫–∏ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Ñ–∞–π–ª–æ–≤

## üìå –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π

**v2.0** (–¢–µ–∫—É—â–∞—è –≤–µ—Ä—Å–∏—è)
- ‚úÖ –î–µ–∫–æ–º–ø–æ–∑–∏—Ü–∏—è –Ω–∞ 3 –º–æ–¥—É–ª—è
- ‚úÖ –ì–ª–∞–≤–Ω—ã–π —Ñ–∞–π–ª: 245 ‚Üí 103 —Å—Ç—Ä–æ–∫–∏ (-58%)
- ‚úÖ –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å —É–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω —Å BaseParser (–≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç str)
- ‚úÖ –ü—Ä–∏–Ω–∏–º–∞–µ—Ç –æ–±—ä–µ–∫—Ç File –≤–º–µ—Å—Ç–æ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
- ‚úÖ chardet –¥–æ–±–∞–≤–ª–µ–Ω –≤ requirements.txt

**v1.0** (–û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è)
- –ú–æ–Ω–æ–ª–∏—Ç–Ω—ã–π —Ñ–∞–π–ª 245 —Å—Ç—Ä–æ–∫
- –í–æ–∑–≤—Ä–∞—â–∞–ª Dict —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –ø–æ–ª—è–º–∏
- –ü—Ä–∏–Ω–∏–º–∞–ª file_path –∏ file_hash –∫–∞–∫ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
