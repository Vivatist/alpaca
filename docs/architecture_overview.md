# –¢–µ–∫—É—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ ALPACA

–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç –æ–ø–∏—Å—ã–≤–∞–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã –ø–æ—Å–ª–µ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ –ø–æ roadmap: –∫–∞–∫ —É—Å—Ç—Ä–æ–µ–Ω—ã —Å–µ—Ä–≤–∏—Å—ã, Python-—Å–ª–æ–∏ –∏ –ø–æ—Ç–æ–∫ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤.

## 1. –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∏ —Å–µ—Ä–≤–∏—Å—ã

```
monitored_folder ‚Üí FileWatcher ‚Üí PostgreSQL+pgvector ‚Üê Worker ‚Üí Ollama ‚Üê‚Üí Unstructured
                                       ‚Üë                                 ‚Üì
                                       ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ Admin Backend ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

| –°–µ—Ä–≤–∏—Å | –†–æ–ª—å | –ö–∞–∫ –∑–∞–ø—É—Å–∫–∞—Ç—å |
|--------|------|---------------|
| **Supabase PostgreSQL+pgvector** | –•—Ä–∞–Ω–∏—Ç —Ç–∞–±–ª–∏—Ü—ã `files` –∏ `chunks`. –†–∞–±–æ—Ç–∞–µ—Ç –æ—Ç–¥–µ–ª—å–Ω–æ –≤ `~/supabase/docker`. | `docker compose up -d` –≤–Ω—É—Ç—Ä–∏ –∫–∞—Ç–∞–ª–æ–≥–∞ Supabase. |
| **FileWatcher** | –°–∫–∞–Ω–∏—Ä—É–µ—Ç `MONITORED_PATH`, –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å—Ç–∞—Ç—É—Å —Ñ–∞–π–ª–æ–≤ –∏ –æ—Ç–¥–∞—ë—Ç –æ—á–µ—Ä–µ–¥—å —á–µ—Ä–µ–∑ REST (`GET /api/next-file`). | `cd services && docker compose up -d` (–≤—Ö–æ–¥–∏—Ç –≤ –æ–±—â–∏–π compose). |
| **Worker (Python)** | –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ—á–µ—Ä–µ–¥—å: –ø–∞—Ä—Å–∏–Ω–≥ ‚Üí —á–∞–Ω–∫–∏–Ω–≥ ‚Üí —ç–º–±–µ–¥–¥–∏–Ω–≥. –°—Ç–∞—Ä—Ç—É–µ—Ç –∏–∑ `main.py`. | `source venv/bin/activate && python main.py`. |
| **Ollama** | LLM (`qwen2.5:32b`) –∏ embedders (`bge-m3`). Worker –æ–±—Ä–∞—â–∞–µ—Ç—Å—è –Ω–∞ `http://localhost:11434`. | –í —Å–æ—Å—Ç–∞–≤–µ `services/docker-compose.yml`. |
| **Unstructured API** | –ü–∞—Ä—Å–∏–Ω–≥ —Å–ª–æ–∂–Ω—ã—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤ (PDF, PPTX –∏ —Ç. –ø.). | –¢–∞–∫–∂–µ –≤ compose, –ø–æ—Ä—Ç `9000`. |
| **Admin Backend** | REST API –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Å—Ç–∞—Ç—É—Å–æ–≤. | Compose, –ø–æ—Ä—Ç `8080`. |

## 2. –ü–æ—Ç–æ–∫ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤

1. **FileWatcher** —Å–∫–∞–Ω–∏—Ä—É–µ—Ç `MONITORED_PATH` –∏ –∏–∑–º–µ–Ω—è–µ—Ç `files.status_sync`: `added`, `updated`, `deleted`, `ok`, `error`, `processed`.
2. **Worker** (ThreadPoolExecutor + —Å–µ–º–∞—Ñ–æ—Ä—ã) –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç `GET /api/next-file`. –ü—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Ñ–∞–π–ª–∞ —Å—Ä–∞–∑—É –ø–æ–º–µ—á–∞–µ—Ç –µ–≥–æ `processed`, —á—Ç–æ–±—ã –∏—Å–∫–ª—é—á–∏—Ç—å –≥–æ–Ω–∫–∏.
3. **ProcessFileEvent** —Ä–µ—à–∞–µ—Ç, —á—Ç–æ –¥–µ–ª–∞—Ç—å:
   - `deleted`: –≤—ã–∑–≤–∞—Ç—å `FileService.delete_file_and_chunks`.
   - `updated`: —É–¥–∞–ª–∏—Ç—å —á–∞–Ω–∫–∏, —Å–Ω–æ–≤–∞ –ø—Ä–æ–π—Ç–∏ –ø–∞–π–ø–ª–∞–π–Ω.
   - `added`: –ø—Ä–æ–π—Ç–∏ –ø–∞–π–ø–ª–∞–π–Ω.
4. **IngestDocument** –≤—ã–ø–æ–ª–Ω—è–µ—Ç —à–∞–≥–∏:
   - –í—ã–±–æ—Ä –ø–∞—Ä—Å–µ—Ä–∞ —á–µ—Ä–µ–∑ `ParserResolver` (WordParser –¥–ª—è DOC/DOCX, –∏–Ω–∞—á–µ `get_parser_for_path`).
   - –ü–∞—Ä—Å–∏–Ω–≥ —Å —Å–µ–º–∞—Ñ–æ—Ä–æ–º `WORKER_MAX_CONCURRENT_PARSING` –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ raw text.
   - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ `.md` –≤–æ –≤—Ä–µ–º–µ–Ω–Ω–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ (`/home/alpaca/tmp_md`).
   - –ß–∞–Ω–∫–∏–Ω–≥ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `custom_chunker`, –ø–æ—Ä—Ü–∏–∏ ‚âà1000 —Å–∏–º–≤–æ–ª–æ–≤).
   - –≠–º–±–µ–¥–¥–∏–Ω–≥ —á–µ—Ä–µ–∑ –≤—ã–±—Ä–∞–Ω–Ω—ã–π backend (HTTP –≤ Ollama –∏–ª–∏ LangChain) c —Å–µ–º–∞—Ñ–æ—Ä–æ–º `WORKER_MAX_CONCURRENT_EMBEDDING`.
   - –ó–∞–ø–∏—Å—å —á–∞–Ω–∫–æ–≤ (jsonb metadata + vector(1024)) –≤ —Ç–∞–±–ª–∏—Ü—É `chunks` –∏ –≤—ã—Å—Ç–∞–≤–ª–µ–Ω–∏–µ `status_sync='ok'`.
5. –ü—Ä–∏ –æ—à–∏–±–∫–∞—Ö —Ñ–∞–π–ª –ø–æ–º–µ—á–∞–µ—Ç—Å—è `error`, –∏—Å–∫–ª—é—á–µ–Ω–∏—è –ª–æ–≥–∏—Ä—É—é—Ç—Å—è —Å —ç–º–æ–¥–∑–∏-–ø—Ä–µ—Ñ–∏–∫—Å–∞–º–∏ (`üçé`, `‚úÖ`, `‚ùå`).

## 3. –°–ª–æ–∏ Python-—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è

| –°–ª–æ–π | –ö–∞—Ç–∞–ª–æ–≥ | –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ |
|------|---------|------------|
| **Domain** | `core/domain/*` | –ß–∏—Å—Ç—ã–µ –º–æ–¥–µ–ª–∏ (`FileSnapshot`), –ø—Ä–æ—Ç–æ–∫–æ–ª—ã –∏ —Ñ–∞—Å–∞–¥—ã –¥–æ–∫—É–º–µ–Ω—Ç-–ø–∞–π–ø–ª–∞–π–Ω–∞. –ù–µ —Å–æ–¥–µ—Ä–∂–∏—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–π, —Ç–æ–ª—å–∫–æ –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã –∏ –º–∞–ø–ø–∏–Ω–≥ (`configure_parser_registry`, `set_chunker`, `set_embedder`). |
| **Application** | `core/application/*` | –†–µ–∞–ª–∏–∑–∞—Ü–∏–∏ use-case'–æ–≤ (`IngestDocument`, `ProcessFileEvent`), —Å–µ—Ä–≤–∏—Å—ã (`FileService`), –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –ø–∞—Ä—Å–µ—Ä—ã/—á–∞–Ω–∫–µ—Ä—ã/—ç–º–±–µ–¥–¥–µ—Ä—ã, bootstrap-—Ñ–∞–±—Ä–∏–∫–∏ –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –≤–Ω–µ—à–Ω–∏–º–∏ —Å–∏—Å—Ç–µ–º–∞–º–∏ –Ω–∞ —É—Ä–æ–≤–Ω–µ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏. |
| **Infrastructure** | `core/infrastructure/*` | –ê–¥–∞–ø—Ç–µ—Ä—ã –∫ –°–£–ë–î –∏ –¥—Ä—É–≥–∏–º system dependencies (–Ω–∞–ø—Ä–∏–º–µ—Ä, `PostgresFileRepository`). |
| **Utils** | `utils/*` | –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ, —Ä–∞–Ω–Ω–µ—Ä `Worker`, –æ–±—â–∏–µ —É—Ç–∏–ª–∏—Ç—ã. |
| **app/** | –ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏. –ù–æ–≤–∞—è –ª–æ–≥–∏–∫–∞ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ `core/`. |

### –ö–∞–∫ –æ–±—ä—è—Å–Ω–∏—Ç—å —ç—Ç–æ –ø—Ä–æ—Å—Ç—ã–º–∏ —Å–ª–æ–≤–∞–º–∏

- **Domain** ‚Äî —ç—Ç–æ ¬´–ø—Ä–∞–≤–∏–ª–∞ –∏–≥—Ä—ã¬ª –∏ —Å–ª–æ–≤–∞—Ä—å —Ç–µ—Ä–º–∏–Ω–æ–≤. –ó–¥–µ—Å—å –æ–ø–∏—Å–∞–Ω–æ *—á—Ç–æ* –º—ã —É–º–µ–µ–º –¥–µ–ª–∞—Ç—å, –Ω–æ –Ω–µ *–∫–∞–∫* –∏–º–µ–Ω–Ω–æ.
- **Application** ‚Äî —ç—Ç–æ ¬´–ø–æ–≤–∞—Ä–µ–Ω–Ω–∞—è –∫–Ω–∏–≥–∞¬ª. –û–Ω–∞ –∑–Ω–∞–µ—Ç —Ä–µ—Ü–µ–ø—Ç—ã –∏ –∫–æ–º–±–∏–Ω–∏—Ä—É–µ—Ç —à–∞–≥–∏, –ø–æ–ª—å–∑—É—è—Å—å –ø—Ä–∞–≤–∏–ª–∞–º–∏ –∏–∑ Domain.
- **Infrastructure** ‚Äî —ç—Ç–æ ¬´—É—Ç–≤–∞—Ä—å¬ª: –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ, HTTP-–∫–ª–∏–µ–Ω—Ç—ã –∏ –≤—Å—ë –∂–µ–ª–µ–∑–æ.
- **Utils** ‚Äî ¬´–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –æ–±—â–µ–≥–æ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è¬ª, –Ω–∞–ø—Ä–∏–º–µ—Ä, –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è.

–ë–ª–∞–≥–æ–¥–∞—Ä—è —Ç–∞–∫–æ–º—É –¥–µ–ª–µ–Ω–∏—é –ª—é–±–æ–π —Å–ª–æ–π –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω –∏–ª–∏ –∑–∞–º–µ–Ω—ë–Ω –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ: Domain –Ω–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –±–∏–±–ª–∏–æ—Ç–µ–∫, –∞ Application –ª–µ–≥–∫–æ –ø–æ–¥–º–µ–Ω—è–µ—Ç –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É –º–æ–∫–∞–º–∏.

## 4. Bootstrap –∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

`core/application/bootstrap.py` ‚Äî –µ–¥–∏–Ω–∞—è —Ç–æ—á–∫–∞ —Å–±–æ—Ä–∫–∏ worker'–∞:

- –§–∞–±—Ä–∏–∫–∏ `build_repository`, `build_word_parser`, `build_chunker`, `build_ingest_document`, `build_worker`.
- `_configure_document_processing_facade` —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –≤ –¥–æ–º–µ–Ω–Ω–æ–º —Å–ª–æ–µ.
- `build_worker_application(settings)` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç dataclass `WorkerApplication` —Å–æ –≤—Å–µ–º–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏ (—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π, —Å–µ—Ä–≤–∏—Å—ã, use-case'—ã, worker, –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –ø–∞—Ä—Å–µ—Ä/—á–∞–Ω–∫–µ—Ä/—ç–º–±–µ–¥–¥–µ—Ä).
- `main.py` –¥–µ–ª–∞–µ—Ç —Ç–æ–ª—å–∫–æ: –∑–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ (–µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω–æ), `build_worker_application`, `ResetStuckFiles`, `worker.start()`.

–¢–µ—Å—Ç—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç —Ç–µ –∂–µ —Ñ–∞–±—Ä–∏–∫–∏ —á–µ—Ä–µ–∑ —Ñ–∏–∫—Å—Ç—É—Ä—ã `worker_app`, `ingest_pipeline`, `process_file_use_case` (—Å–º. `tests/conftest.py`).

### –ü—Ä–∏–Ω—Ü–∏–ø Dependency Injection

1. **–†–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è –Ω–∞–≤–µ—Ä—Ö—É** (–≤ bootstrap) –∏ –∑–∞–¥–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ —Ñ—É–Ω–∫—Ü–∏–∏ `set_chunker`, `set_embedder`, `configure_parser_registry`.
2. **–î–æ–º–µ–Ω –Ω–∏—á–µ–≥–æ –Ω–µ –∑–Ω–∞–µ—Ç –æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –∫–ª–∞—Å—Å–∞—Ö** ‚Äî –æ–Ω –ø—Ä–æ—Å–∏—Ç ¬´–¥–∞–π –ø–∞—Ä—Å–µ—Ä¬ª –∏–ª–∏ ¬´–¥–∞–π chunker¬ª, –∞ bootstrap —Ä–∞–Ω–µ–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–ª, —á—Ç–æ –∏–º–µ–Ω–Ω–æ –Ω–∞–¥–æ –≤–µ—Ä–Ω—É—Ç—å.
3. **Worker –∏ —Ç–µ—Å—Ç—ã –ø–æ–ª—É—á–∞—é—Ç –≥–æ—Ç–æ–≤—ã–π –Ω–∞–±–æ—Ä –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π** —á–µ—Ä–µ–∑ `WorkerApplication`, –Ω–µ —Å–æ–∑–¥–∞–≤–∞—è –æ–±—ä–µ–∫—Ç—ã –≤—Ä—É—á–Ω—É—é.

–≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –ª–µ–≥–∫–æ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã: –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫—É (`EMBEDDER_BACKEND`) –∏–ª–∏ –ø–µ—Ä–µ–¥–∞—Ç—å –¥—Ä—É–≥—É—é —Ñ–∞–±—Ä–∏–∫—É, –∫–æ–¥ –¥–æ–º–µ–Ω–∞/—é–∑–∫–µ–π—Å–æ–≤ –æ—Å—Ç–∞—ë—Ç—Å—è –ø—Ä–µ–∂–Ω–∏–º.

## 5. –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

**–¢–∞–±–ª–∏—Ü–∞ `files`**
- –ö–ª—é—á: `hash` (SHA256). –ü–æ–ª—è: `file_path`, `file_hash`, `file_size`, `file_mtime`, `status_sync`, `last_checked`.
- –°—Ç–∞—Ç—É—Å—ã –ø—Ä–æ—Ö–æ–¥—è—Ç —Ü–µ–ø–æ—á–∫—É `added/updated/deleted ‚Üí processed ‚Üí ok/error`.

**–¢–∞–±–ª–∏—Ü–∞ `chunks`**
- –ü–æ–ª—è: `content`, `metadata` (JSONB —Å `file_hash`, `file_path`, `chunk_index`, `total_chunks`), `embedding` (`vector(1024)` –¥–ª—è bge-m3).
- –°–ª—É–∂–±—ã —É–¥–∞–ª—è—é—Ç —á–∞–Ω–∫–∏ –ø–æ `metadata->>'file_hash'`.

## 6. –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–í—Å–µ –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ `settings.py`, —Å–µ–∫—Ä–µ—Ç—ã ‚Äî –≤ `.env`.

–ö–ª—é—á–µ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|----------|------------|
| `DATABASE_URL` | –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Supabase/PostgreSQL (—Ö—Ä–∞–Ω–∏—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ `.env`). |
| `MONITORED_PATH` | –ü—É—Ç—å, –∫–æ—Ç–æ—Ä—ã–π —Å–∫–∞–Ω–∏—Ä—É–µ—Ç FileWatcher. |
| `WORKER_MAX_CONCURRENT_FILES/PARSING/EMBEDDING/LLM` | –õ–∏–º–∏—Ç—ã –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ—Å—Ç–∏. |
| `RUN_TESTS_ON_START` / `TEST_SUITE` | –ê–≤—Ç–æ–∑–∞–ø—É—Å–∫ pytest –ø–µ—Ä–µ–¥ —Å—Ç–∞—Ä—Ç–æ–º worker'–∞. |
| `OLLAMA_BASE_URL`, `OLLAMA_LLM_MODEL`, `OLLAMA_EMBEDDING_MODEL` | –ù–∞—Å—Ç—Ä–æ–π–∫–∏ Ollama. |
| `EMBEDDER_BACKEND` | –í—ã–±–æ—Ä —ç–º–±–µ–¥–¥–µ—Ä–∞ (`custom`/`langchain`). Bootstrap –≤—ã–±–∏—Ä–∞–µ—Ç –Ω—É–∂–Ω—É—é —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é –∏ —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç –µ—ë –≤ –¥–æ–º–µ–Ω–µ. |

–ò–∑–º–µ–Ω–µ–Ω–∏–µ embedder'–∞:
```bash
export EMBEDDER_BACKEND=langchain
python main.py
```

## 7. –û–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ –ø—Ä–∞–∫—Ç–∏–∫–∏

- **–°–±—Ä–æ—Å –∑–∞–≤–∏—Å—à–∏—Ö —Ñ–∞–π–ª–æ–≤**: –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ `ResetStuckFiles` –ø–µ—Ä–µ–≤–æ–¥–∏—Ç `processed ‚Üí added`. –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –º–æ–∂–Ω–æ –≤—ã–∑–≤–∞—Ç—å `db.reset_processed_statuses()` –≤—Ä—É—á–Ω—É—é.
- **–õ–æ–≥–∏**: `utils.logging` –∑–∞–¥–∞—ë—Ç –µ–¥–∏–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç; –∫—Ä—É–ø–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è –ø–æ–º–µ—á–∞—é—Ç—Å—è —ç–º–æ–¥–∑–∏.
- **–í—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã**: —Ä–∞—Å–ø–∞—Ä—Å–µ–Ω–Ω—ã–µ —Ç–µ–∫—Å—Ç—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ `/home/alpaca/tmp_md` –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏.
- **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**: –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–∞—è –¥–æ—Ä–æ–∂–Ω–∞—è –∫–∞—Ä—Ç–∞ (`docs/architecture_roadmap.md`) –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å —É–º–µ–Ω—å—à–µ–Ω–∏—è —Å–≤—è–∑–∞–Ω–Ω–æ—Å—Ç–∏; `docs/SETTINGS_ARCHITECTURE.md` –æ–ø–∏—Å—ã–≤–∞–µ—Ç —Å–≤—è–∑—å –Ω–∞—Å—Ç—Ä–æ–µ–∫ –∏ bootstrap.

–≠—Ç–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω—É—é –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç –¥–æ–º–µ–Ω–∞ –∫ –ø—Ä–∏–∫–ª–∞–¥–Ω–æ–º—É –∫–æ–¥—É, –∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É–µ–º—ã–π –≤—ã–±–æ—Ä —ç–º–±–µ–¥–¥–µ—Ä–∞ –∏ –µ–¥–∏–Ω—ã–π bootstrap –¥–ª—è worker'–∞ –∏ —Ç–µ—Å—Ç–æ–≤.

## 8. –ü—Ä–æ—Ü–µ—Å—Å –∑–∞–ø—É—Å–∫–∞ (—á—Ç–æ –∑–∞ —á–µ–º –≤–∫–ª—é—á–∞—Ç—å)

1. **Supabase** (`~/supabase/docker`): `docker compose up -d`. –ë–∞–∑–∞ –≥–æ—Ç–æ–≤–∞ –ø—Ä–∏–Ω–∏–º–∞—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è.
2. **–°–µ—Ä–≤–∏—Å—ã ALPACA** (`services/docker-compose.yml`): `docker compose up -d`. –≠—Ç–æ –ø–æ–¥–Ω–∏–º–µ—Ç FileWatcher, Ollama, Unstructured, Admin Backend.
3. **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Ä–≤–∏—Å–æ–≤** (–ø–æ –∂–µ–ª–∞–Ω–∏—é): `curl http://localhost:11434/api/tags`, `curl http://localhost:9000/general/v0/general`.
4. **Worker**: `source venv/bin/activate && python main.py`. –°–∫—Ä–∏–ø—Ç –ø—Ä–æ–≥–æ–Ω–∏—Ç —Ç–µ—Å—Ç—ã (–µ—Å–ª–∏ `RUN_TESTS_ON_START=True`), —Å–æ–±–µ—Ä—ë—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ via bootstrap –∏ –∑–∞–ø—É—Å—Ç–∏—Ç –ø–æ—Ç–æ–∫ –æ–±—Ä–∞–±–æ—Ç–∫–∏.

–ò—Ç–æ–≥–æ–≤–∞—è —Ü–µ–ø–æ—á–∫–∞ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–π –≤—ã–≥–ª—è–¥–∏—Ç —Ç–∞–∫:

```
monitored_folder
   ‚îÇ
   ‚ñº
FileWatcher (docker) ‚îÄ‚îÄ‚ñ∫ PostgreSQL.files (Supabase)
   ‚îÇ                          ‚ñ≤
   ‚îÇ                          ‚îÇ
   ‚îî‚îÄ‚îÄ‚ñ∫ Worker (python) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
            ‚îÇ
            ‚îú‚îÄ‚îÄ‚ñ∫ Unstructured (–¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞ —Å–ª–æ–∂–Ω—ã—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤)
            ‚îî‚îÄ‚îÄ‚ñ∫ Ollama (—ç–º–±–µ–¥–¥–∏–Ω–≥–∏/LLM)
```

–†–∞–±–æ—Ç–∞—è –ø–æ —ç—Ç–æ–π –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏, –ª–µ–≥–∫–æ –ø–æ–Ω—è—Ç—å –≥–¥–µ –∏—Å–∫–∞—Ç—å –ø—Ä–æ–±–ª–µ–º—É: –µ—Å–ª–∏ Worker –Ω–µ –º–æ–∂–µ—Ç –ø–æ–ª—É—á–∏—Ç—å —Ñ–∞–π–ª ‚Äî –ø—Ä–æ–≤–µ—Ä—è–µ–º FileWatcher/DB; –µ—Å–ª–∏ —ç–º–±–µ–¥–¥–∏–Ω–≥–∏ –Ω–µ —Å–æ–∑–¥–∞—é—Ç—Å—è ‚Äî —Å–º–æ—Ç—Ä–∏–º –∑–∞–ø—Ä–æ—Å—ã –≤ Ollama –∏ —Ç. –¥.
